# .github/workflows/deploy.yml
name: Deploy Specific Folders to R2

on:
    push:
        branches:
            - main
jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup rclone and sync to R2
              run: |
                  sudo apt-get update && sudo apt-get install -y rclone

                  rclone sync . :s3,provider=Cloudflare,access_key_id=${{ secrets.CLOUDFLARE_R2_ACCESS_KEY_ID }},secret_access_key=${{ secrets.CLOUDFLARE_R2_SECRET_ACCESS_KEY }},endpoint=https://${{ secrets.CLOUDFLARE_ACCOUNT_ID}}.r2.cloudflarestorage.com:lumilio-photos-code/ \
                              --filter "+ /pml/**" \
                              --filter "+ /server/**" \
                              --filter "+ /web/**" \
                              --filter "- *" \
                              --fast-list \
                              --transfers 16 \
                              -v --progress
